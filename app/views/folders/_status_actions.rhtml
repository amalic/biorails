
<table>
  <th><%=l(:Possible_new_states)%>:</th>

  <% for item in @project_folder.allowed_states(false) %>
    <%  unless item == @project_folder.state %>
      <th>
        <% if  @allowed and @allowed.any?{|i|i == item} %>

          <% if item.signed? %>
            <%=button_to item.name, signature_url(:action=>:new, :id=>@project_folder.id, :state_id=> item.id),  :class =>"icon icon-sign" if right?(:document,:publish) %>
          <% elsif @signature and @project_folder.state.signed? %>
            <%=button_to item.name, signature_url(:action=>:withdraw, :id=>@signature.id, :state_id=> item.id),  :class =>"icon icon-withdraw" if right?(:document,:withdraw) %>
          <% else %>
            <%=button_to item.name, folder_url(:action=>:publish, :id=>@project_folder.id, :state_id=> item.id), :class =>"icon icon-release" %>
          <%end %>

        <% else%>

          <% if item.signed? %>
            [<%=item.name%>]
          <% else %>
            <%=button_to item.name,
              folder_url(:action=>:publish, :id=>@project_folder.id, :state_id=> item.id),
              :class =>"icon icon-warning",
              :confirm=>"This state is not valid for all child elements" %>
          <% end %>

        <% end %>
      </th>
    <% end %>
  <% end %>
</table>
